/**
 * PaulZi Form
 * @see https://github.com/paulzi/paulzi-form
 * @license MIT (https://github.com/paulzi/paulzi-form/blob/master/LICENSE)
 * @version 3.0.4
 */
!function(a,b){"function"==typeof define&&define.amd?define(["jquery"],function(c){return a.PaulZiForm=b(c)}):"object"==typeof module&&module.exports?module.exports=b(require("jquery")):a.PaulZiForm=b(a.jQuery)}(this,function(a){"use strict";var b=window,c=document,d=a(c),e=function(b){var c=a();return b.icon&&(c=c.add(a("<i>").addClass(b.icon))),b.text&&(c=c.add(a("<span>").text(b.text))),c},f=a.extend(!0,{classes:{formLoading:"form-loading",btnLoading:"btn-loading"},attributes:{via:"data-via",lock:"data-lock",submitEmpty:"data-submit-empty",to:"data-insert-to",context:"data-insert-context",mode:"data-insert-mode",params:"data-insert-params",loadingText:"data-loading-text",loadingIcon:"data-loading-icon"},defaults:{lock:!0,submitEmpty:!0,to:"output",context:"this",mode:"html",params:"true",skipOnError:!1},defaultTemplate:e,buttonLoadingTemplate:e,buttonLoadingForce:!1},b.PaulZiForm||{}),g=function(b){var d='input[type="submit"],input[type="image"],button[type="submit"],:not(button[type])',e=a(c.activeElement).filter(d);return a.each(b.elements,function(b,c){c=a(c).filter(d),!e.length&&c.length&&(e=c)}),e},h="paulziForm",i="."+h,j="submitlast",k="submitbefore",l="submitstart",m="submitend",n=f.classes,o=f.attributes,p=f.defaults,q=h+"NoEmpty",r=function(b){var c=a(b.target),d=[];a.each(c.prop("elements"),function(b,e){if(""===e.value&&!e.disabled&&"submit"!==e.type){var f=a(e).closest("["+o.submitEmpty+"]").attr(o.submitEmpty)||c.attr(o.submitEmpty);f=f?a.inArray(f,["1","true"])!==-1:p.submitEmpty,f||(e.disabled=!0,d.push(e))}}),c.data(q,d)},s=function(b){var c=a(b.target).data(q);c&&a.each(c,function(a,b){b.disabled=!1})};d.on(k+i,r),d.on(l+i,s);var t=h+"Lock",u=function(b){var c=a(b.target);if(c.data(t)){var d=c.attr(o.lock);("undefined"!=typeof d?a.inArray(d,["1","true"])!==-1:p.lock)&&b.preventDefault()}},v=function(b){a(b.target).data(t,!0)},w=function(b){a(b.target).data(t,!1)};d.on(j+i,u),d.on(k+i,v),d.on(m+i,w);var x=h+"Scenario",y=function(b){var c=a(b.target),d=[];a.each(c.prop("elements"),function(c,e){var f=a(e).closest("form, ["+o.via+"]").not("form").attr(o.via);f&&"all"!==f&&f!==b.transport&&!e.disabled&&"submit"!==e.type&&(e.disabled=!0,d.push(e))}),c.data(x,d)},z=function(b){var c=a(b.target).data(x);c&&a.each(c,function(a,b){b.disabled=!1})};d.on(k+i,y),d.on(l+i,z);var A=h+"Catch",B=function(c){var d=a(c.target),e=g(c.target),f=b.FormExtraEvents.dataAttribute,h=e.data(f);"undefined"!=typeof h&&(d.data(A,d.data(f)||{}),d.data(f,h))},C=function(c){var d=a(c.target),e=b.FormExtraEvents.dataAttribute,f=d.data(A);"undefined"!=typeof f&&(d.data(e,f||{}),d.removeData(A))};d.on(k+i,B),d.on(l+i,C);var D=function(b){var c=a(this),d=c.offset();c.data(h+"X",Math.round(b.pageX-d.left)).data(h+"Y",Math.round(b.pageY-d.top))},E=function(c){var d=a(c.target),e=g(c.target),f=d.attr(o.via),i=e.attr(o.via);if(!c.isDefaultPrevented()&&("ajax"===f&&!i||"ajax"===i)){c.preventDefault();var j=a.Event("submitajax");if(d.trigger(j),!j.isDefaultPrevented()){var n=function(a,b){d.trigger({type:a,transport:"ajax"},b)};n(k);var p={url:e.attr("formaction")||d.attr("action"),method:e.attr("formmethod")||d.attr("method")||"GET",contentType:e.attr("formenctype")||d.attr("enctype"),xhr:function(){var b=a.ajaxSettings.xhr(),c=function(b){return function(c){var e=a.Event(c,{type:b,loaded:c.loaded,total:c.total,lengthComputable:c.lengthComputable});d.trigger(e)}};return b.addEventListener&&b.addEventListener("progress",c("downloadprogress")),b.upload&&b.upload.addEventListener&&(b.upload.addEventListener("progress",c("uploadprogress")),b.upload.addEventListener("loadend",c("uploadend"))),b}},q=[],r=e.attr("name");if(r){var s;s=e.data(h+"X"),"undefined"!=typeof s?q.push({name:r+".x",value:s}):q.push({name:r,value:e.val()}),s=e.data(h+"Y"),"undefined"!=typeof s&&q.push({name:r+".y",value:s})}if("multipart/form-data"===p.contentType)if("FormData"in b){var t=new FormData(d[0]);a.each(q,function(a,b){t.append(b.name,b.value)}),p.data=t,p.processData=!1,p.contentType=!1}else p.data=q,p.form=d[0],p.iframe=!0,p.iframeOnSubmit=n(l);else p.data=a.merge(d.serializeArray(),q);a.ajax(p).done(function(a,b,c){n("submitdone",[a,c])}).fail(function(a,b,c){n("submitfail",[a.responseText,a,c])}).always(function(){var a,b,c;"object"==typeof arguments[2]?(a=arguments[0],b=arguments[2]):(a=arguments[0].responseText,b=arguments[0],c=arguments[2]),n(m,[a,b,c])}),p.iframe||n(l)}}};d.on("click"+i,'input[type="image"]',D),d.on(j+i,E);var F=function(b,e,f,g){if("ajax"===b.transport){var h=f.getResponseHeader("X-Redirect");h&&(c.location.href=h,b.preventDefault());var i=f.getResponseHeader("Content-Type");if(!b.isDefaultPrevented()&&(null===i||/^text\/html(;|$)/.test(i))){var j=a(b.target),k=a(a.parseHTML(e,!0));g&&p.skipOnError||k.each(function(){var b=a(this),c=b.attr(o.to)||j.attr(o.to)||p.to,e=b.attr(o.context)||j.attr(o.context)||p.context,f=b.attr(o.mode)||j.attr(o.mode)||p.mode,g=b.attr(o.params)||j.attr(o.params)||p.params;e&&c&&(e="document"===e?d:"this"===e?j:j.closest(e),c="context"===c?e:e.find(c)),c&&c.length&&c[f]&&(j.trigger("contentprepare",[k,f,c]),"true"===g?c[f](this):"false"===g?c[f]():c[f](g,this),j.trigger("contentinit",[k,f,c]))})}}};o.via!==!1&&d.on(m+i,F);var G=function(b){var c=a(b.target).addClass(n.formLoading),d=g(b.target).addClass(n.btnLoading),e={form:c[0],btn:d[0],text:d.attr(o.loadingText),icon:d.attr(o.loadingIcon)};if(c.data(h+"Btn",d),e.text||e.icon||f.buttonLoadingForce){var i=f.buttonLoadingTemplate(e);i&&(d.data(h+"Old",d.contents()),d.html(i))}},H=function(b){var c=a(b.target).removeClass(n.formLoading),d=c.data(h+"Btn");if(d){var e=d.data(h+"Old");d.html(e),d.removeClass(n.btnLoading)}};return d.on(k+i,G),d.on(m+i,H),f});